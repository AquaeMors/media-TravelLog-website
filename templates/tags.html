{% extends "base.html" %}
{% block title %}Tags{% endblock %}
{% block head %}
<link href="{{ url_for('static', filename='css/tracker.css') }}" rel="stylesheet">
<style>
  /* small, page-local helpers */
  .tags-header { display:flex; align-items:center; justify-content:space-between; gap:.75rem; }
  .alpha-nav { display:flex; flex-wrap:wrap; gap:.35rem; }
  .alpha-nav a { text-decoration:none; font-weight:600; opacity:.85; }
  .alpha-nav a:hover { opacity:1; color: var(--accent-600); }
  .tag-section { margin-top:1rem; }
  .tag-section h6 { margin:.75rem 0 .5rem; opacity:.8; }
  .tags-wrap { display:flex; flex-wrap:wrap; gap:.35rem; }
</style>
{% endblock %}

{% block content %}
<div class="container py-4">

  <div class="tags-header mb-2">
    <div>
      <h1 class="h4 mb-1">Tags{% if type_filter %} — <span class="text-capitalize">{{ type_filter }}</span>{% endif %}</h1>
      <div class="small">
        <a href="{{ url_for('tracker') }}" class="link-primary me-2">All types</a>
        {% set ICONS = {'book':'book','movie':'film','show':'tv','anime':'collection-play','manga':'journals','manhwa':'journals','game':'controller','other':'list'} %}
        {% for t in MEDIA_TYPES %}
          <a class="pill {% if t==type_filter %}active{% endif %}" href="{{ url_for('tracker_tags', type=t) }}">
            <i class="bi bi-{{ ICONS.get(t,'list') }}"></i>
            <span class="text-capitalize">{{ t }}</span>
          </a>
        {% endfor %}
      </div>
    </div>

    <form class="d-flex gap-2" method="get">
      {% if type_filter %}<input type="hidden" name="type" value="{{ type_filter }}">{% endif %}
      <input class="form-control form-control-sm w-18rem" type="search" name="q" value="{{ q }}"
             placeholder="Search tags…">
      <button class="btn btn-outline-primary btn-sm">Filter</button>
    </form>
  </div>

  {% if letters %}
    <div class="alpha-nav mb-3">
      {% for L in letters %}
        <a href="#L-{{ L }}">{{ L }}</a>
      {% endfor %}
    </div>

    {% for L in letters %}
      <div class="tag-section" id="L-{{ L }}">
        <h6 class="text-muted">{{ L }}</h6>
        <div class="tags-wrap">
          {% for tag, ct in grouped[L] %}
            <a class="pill tag-pill"
               href="{{ tracker_base }}?type={{ type_filter if type_filter else 'book' }}&tag={{ tag|urlencode }}">
              {{ tag }}
              <span class="count">{{ ct }}</span>
            </a>
          {% endfor %}
        </div>
      </div>
    {% endfor %}
  {% else %}
    <div class="text-muted">No tags found.</div>
  {% endif %}

</div>
{% endblock %}
