<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
  <title>User Requests</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">

<nav class="navbar bg-white border-bottom">
  <div class="container">
    <a class="navbar-brand fw-semibold" href="/home">Home</a>
    <div class="d-flex align-items-center gap-2">
      <span class="text-muted small">Admin: <strong>{{ current_user.username }}</strong></span>
      <a class="btn btn-outline-secondary btn-sm" href="/admin/requests">User Requests</a>
      <form method="post" action="/logout" class="m-0 ms-2">
        <button class="btn btn-outline-danger btn-sm">Logout</button>
      </form>
    </div>
  </div>
</nav>

<div class="container py-4">
  {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      {% for cat, msg in messages %}
        <div class="alert alert-{{ 'info' if cat=='message' else cat }}">{{ msg }}</div>
      {% endfor %}
    {% endif %}
  {% endwith %}

  <div class="d-flex align-items-center justify-content-between mb-3">
    <h1 class="h4 mb-0">Pending Account Requests</h1>
  </div>

  {% if pending %}
    <div class="table-responsive">
      <table class="table align-middle">
        <thead>
          <tr>
            <th>Username</th>
            <th>Reason</th>
            <th>Requested</th>
            <th style="width:180px;"></th>
          </tr>
        </thead>
        <tbody>
          {% for r in pending %}
            <tr>
              <td class="fw-semibold">{{ r.username }}</td>
              <td class="text-muted">{{ r.reason or '—' }}</td>
              <td class="text-muted small">{{ r.created_at.strftime('%Y-%m-%d %H:%M') }}</td>
              <td class="text-end">
                <form method="post" action="/admin/requests/{{ r.id }}/approve" class="d-inline">
                  <button class="btn btn-sm btn-success">Approve</button>
                </form>
                <form method="post" action="/admin/requests/{{ r.id }}/deny" class="d-inline" onsubmit="return confirm('Deny this request?');">
                  <button class="btn btn-sm btn-outline-danger">Deny</button>
                </form>
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  {% else %}
    <div class="alert alert-info">No pending requests.</div>
  {% endif %}

  <hr class="my-4">

  <h2 class="h5">Recent decisions</h2>
  {% if recent %}
    <ul class="list-group">
      {% for r in recent %}
        <li class="list-group-item d-flex justify-content-between">
          <div>
            <strong>{{ r.username }}</strong>
            <span class="badge {% if r.status=='approved' %}text-bg-success{% else %}text-bg-secondary{% endif %} ms-2">
              {{ r.status }}
            </span>
            <div class="text-muted small">{{ r.reason or '—' }}</div>
          </div>
          <div class="text-muted small">
            {{ r.decided_at.strftime('%Y-%m-%d %H:%M') if r.decided_at else '' }}
          </div>
        </li>
      {% endfor %}
    </ul>
  {% else %}
    <div class="text-muted">No recent approvals/denials yet.</div>
  {% endif %}
</div>

</body>
</html>

